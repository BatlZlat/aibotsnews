name: Test Telegram Notifications

on:
  workflow_dispatch: # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

jobs:
  test-telegram:
    runs-on: ubuntu-latest

    steps:
      - name: Test Telegram Success
        run: |
          echo "üì± –¢–µ—Å—Ç–∏—Ä—É–µ–º —É—Å–ø–µ—à–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ..."
          RESPONSE=$(curl -s -w "\n%{http_code}" -X POST https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage \
            -d chat_id=${{ secrets.ADMIN_IDS }} \
            -d text="üß™ –¢–µ—Å—Ç: –£—Å–ø–µ—à–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç GitHub Actions!")
          
          HTTP_CODE=$(echo "$RESPONSE" | tail -n1)
          RESPONSE_BODY=$(echo "$RESPONSE" | head -n -1)
          
          echo "HTTP Code: $HTTP_CODE"
          echo "Response: $RESPONSE_BODY"
          
          if [ "$HTTP_CODE" != "200" ]; then
            echo "‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: $HTTP_CODE"
            echo "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ TELEGRAM_TOKEN –∏ ADMIN_IDS –≤ —Å–µ–∫—Ä–µ—Ç–∞—Ö GitHub"
            exit 1
          else
            echo "‚úÖ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ"
          fi

      - name: Test Telegram Error
        run: |
          echo "üì± –¢–µ—Å—Ç–∏—Ä—É–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ..."
          RESPONSE=$(curl -s -w "\n%{http_code}" -X POST https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage \
            -d chat_id=${{ secrets.ADMIN_IDS }} \
            -d text="üß™ –¢–µ—Å—Ç: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –æ—Ç GitHub Actions!")
          
          HTTP_CODE=$(echo "$RESPONSE" | tail -n1)
          RESPONSE_BODY=$(echo "$RESPONSE" | head -n -1)
          
          echo "HTTP Code: $HTTP_CODE"
          echo "Response: $RESPONSE_BODY"
          
          if [ "$HTTP_CODE" != "200" ]; then
            echo "‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ: $HTTP_CODE"
            echo "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ TELEGRAM_TOKEN –∏ ADMIN_IDS –≤ —Å–µ–∫—Ä–µ—Ç–∞—Ö GitHub"
            exit 1
          else
            echo "‚úÖ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ"
          fi

      - name: Debug Secrets
        run: |
          echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤..."
          if [ -n "${{ secrets.TELEGRAM_TOKEN }}" ]; then
            echo "‚úÖ TELEGRAM_TOKEN —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
            echo "–¢–æ–∫–µ–Ω: ${#{{ secrets.TELEGRAM_TOKEN }}} —Å–∏–º–≤–æ–ª–æ–≤"
          else
            echo "‚ùå TELEGRAM_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
          fi
          
          if [ -n "${{ secrets.ADMIN_IDS }}" ]; then
            echo "‚úÖ ADMIN_IDS —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
            echo "ID: ${{ secrets.ADMIN_IDS }}"
          else
            echo "‚ùå ADMIN_IDS –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
          fi