name: Test Telegram Notifications

on:
  workflow_dispatch: # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

jobs:
  test-telegram:
    runs-on: ubuntu-latest
    
    steps:
      - name: Test Telegram Success Notification
        run: |
          echo "üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± —É—Å–ø–µ—Ö–µ..."
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤
          if [ -z "${{ secrets.TELEGRAM_TOKEN }}" ]; then
            echo "‚ùå TELEGRAM_TOKEN –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
            exit 1
          fi
          
          if [ -z "${{ secrets.ADMIN_IDS }}" ]; then
            echo "‚ùå ADMIN_IDS –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
            exit 1
          fi
          
          echo "‚úÖ –°–µ–∫—Ä–µ—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã"
          echo "TELEGRAM_TOKEN: ${#{{ secrets.TELEGRAM_TOKEN }}} —Å–∏–º–≤–æ–ª–æ–≤"
          echo "ADMIN_IDS: ${{ secrets.ADMIN_IDS }}"
          
          # –¢–µ—Å—Ç–∏—Ä—É–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É
          RESPONSE=$(curl -s -w "\n%{http_code}" -X POST https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage \
            -d chat_id=${{ secrets.ADMIN_IDS }} \
            -d text="üß™ –¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç GitHub Actions - $(date)")
          
          HTTP_CODE=$(echo "$RESPONSE" | tail -n1)
          RESPONSE_BODY=$(echo "$RESPONSE" | head -n -1)
          
          echo "HTTP Code: $HTTP_CODE"
          echo "Response: $RESPONSE_BODY"
          
          if [ "$HTTP_CODE" = "200" ]; then
            echo "‚úÖ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ"
          else
            echo "‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"
            echo "–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:"
            echo "1. –ù–µ–≤–µ—Ä–Ω—ã–π TELEGRAM_TOKEN"
            echo "2. –ù–µ–≤–µ—Ä–Ω—ã–π ADMIN_IDS"
            echo "3. –ë–æ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω"
            exit 1
          fi